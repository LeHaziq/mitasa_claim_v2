{% extends "base.html" %}
{% load custom_filters %}
{% block content %}
    <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1>
                    {% block page_title %}
                        {{ request.user.first_name }}
                    {% endblock page_title %}
                </h1>
            </div>
            <div>
                <a class="btn btn-outline-primary" data-mdb-ripple-init data-mdb-ripple-color="dark">Claim History <i class="fas fa-clock-rotate-left"></i></a>
            </div>
        </div>
        {% block cards %}
            <hr class="hr">
            <div class="card-group">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-center text-warning">
                            Pending Claims <i class="fas fa-clock"></i>
                        </h5>
                        <hr class="hr">
                        <p class="card-text text-center lead">{{ pending_claims_count }} Claims</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-center text-warning">
                            Pending Amount <i class="fas fa-coins"></i>
                        </h5>
                        <hr class="hr">
                        <p class="card-text text-center lead">RM {{ total_pending_amount }}</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-center text-success">
                            Approved Claims <i class="fas fa-check"></i>
                        </h5>
                        <hr class="hr">
                        <p class="card-text text-center lead">{{ approved_claims_count }} Claims</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title text-center text-success">
                            Approved Amount <i class="fas fa-hand-holding-dollar"></i>
                        </h5>
                        <hr class="hr">
                        <p class="card-text text-center lead">RM {{ total_approved_amount }}</p>
                    </div>
                </div>
            </div>
            <hr class="hr">
        {% endblock cards %}
        {% block dashboard_content %}
            <!--PENDING CLAIMS-->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                    <h2>Pending Claims</h2>
                </div>
                <div>
                    <a class="btn btn-primary" href="{% block add_claim_link %}{% endblock add_claim_link %}" data-mdb-ripple-init>Add Claim <i class="fas fa-plus"></i></a>
                </div>
            </div>
            {% if pending_claims_count %}
                <div class="accordion" id="accordionPanelsStayOpenExample">
                    {% for month, claims in pending_claims_by_month.items %}
                        {% if claims|length %}
                            <div class="accordion-item">
                                <h3 class="accordion-header" id="heading_{{ month }}">
                                    <button data-mdb-collapse-init
                                            class="accordion-button"
                                            type="button"
                                            data-mdb-toggle="collapse"
                                            data-mdb-target="#panelsStayOpen-collapse_{{ month }}"
                                            aria-expanded="true"
                                            aria-controls="panelsStayOpen-collapse_{{ month }}">
                                        <div class="d-flex w-100 justify-content-between me-4 ">
                                            {{ month_names|get:month }}
                                            <span class="d-flex">
                                                <p class="m-0 me-4">
                                                    <span class="bold-small">Total Pending:</span>RM{{ total_pending_amount_by_month|get:month }}
                                                </p>
                                                <span class="badge rounded-pill bg-warning">{{ claims|length }}</span>
                                            </span>
                                        </div>
                                    </button>
                                </h3>
                                <div id="panelsStayOpen-collapse_{{ month }}"
                                    class="accordion-collapse collapse show"
                                    aria-labelledby="heading_{{ month }}">
                                    <div class="accordion-body">
                                        {% if claims %}
                                            <div class="table-responsive">
                                                <table class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">Claim ID</th>
                                                            <th scope="col">Program Name</th>
                                                            <th scope="col">Program Date</th>
                                                            <th scope="col">Created At</th>
                                                            <th scope="col">Total Amount (RM)</th>
                                                            <th scope="col">Status</th>
                                                            <th scope="col">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for claim in claims %}
                                                            <tr>
                                                                <td>
                                                                    <a href="#">#{{ claim.id }}</a>
                                                                </td>
                                                                <td>{{ claim.program_name }}</td>
                                                                <td>{{ claim.program_start_date }}</td>
                                                                <td>{{ claim.created_at }}</td>
                                                                <td>{{ claim.total_amount }}</td>
                                                                <td>
                                                                    {% if claim.claim_status.id == 1 %}
                                                                        <span class="badge bg-warning">{{ claim.claim_status }}</span>
                                                                    {% elif claim.claim_status.id == 2 %}
                                                                        <span class="badge bg-success">{{ claim.claim_status }}</span>
                                                                    {% elif claim.claim_status.id == 3 %}
                                                                        <span class="badge bg-danger">{{ claim.claim_status }}</span>
                                                                    {% else %}
                                                                        {{ claim.claim_status }}
                                                                    {% endif %}
                                                                </td>
                                                                <td>
                                                                    <!-- Button - Delete Claim -->
                                                                    {% if claim.claim_status.id == 1 %}
                                                                        <button type="button"
                                                                                class="btn btn-danger"
                                                                                data-mdb-modal-init
                                                                                data-mdb-target="#delete{{ claim.id }}"
                                                                                data-mdb-ripple-init>
                                                                            <i class="fa-solid fa-trash-can fa-lg"></i>
                                                                        </button>
                                                                    {% endif %}
                                                                    <!-- Modal - Delete Claim -->
                                                                    <div class="modal fade"
                                                                        id="delete{{ claim.id }}"
                                                                        tabindex="-1"
                                                                        aria-labelledby="myModalLabel2"
                                                                        aria-hidden="true">
                                                                        <div class="modal-dialog" role="document">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                    <h5 class="modal-title">
                                                                                        Claim ID: {{ claim.id }}
                                                                                        <br />
                                                                                        Program Name: {{ claim.program_name }}
                                                                                    </h5>
                                                                                    <button type="button"
                                                                                            class="btn-close"
                                                                                            data-mdb-ripple-init
                                                                                            data-mdb-dismiss="modal"
                                                                                            aria-label="Close">
                                                                                        <span aria-hidden="true"></span>
                                                                                    </button>
                                                                                </div>
                                                                                <div class="modal-body">
                                                                                    <p>Are you sure you want to delete this claim?</p>
                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                    <form action="#" method="post">
                                                                                        {% csrf_token %}
                                                                                        <input type="submit" class="btn btn-danger" data-mdb-ripple-init value="Delete" />
                                                                                    </form>
                                                                                    <button type="button" class="btn btn-secondary" data-mdb-dismiss="modal">Cancel</button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <h5 class="alert alert-warning">No claim records</h5>
            {% endif %}
            <hr class="hr">
            <!--APPROVED CLAIMS-->
            <h2 class="mb-3">Approved Claims</h2>
            <div class="accordion" id="accordionPanelsStayOpenExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button data-mdb-collapse-init
                                class="accordion-button"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseOne"
                                aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseOne">Accordion Item #1</button>
                    </h2>
                    <div id="panelsStayOpen-collapseOne"
                         class="accordion-collapse collapse show"
                         aria-labelledby="headingOne">
                        <div class="accordion-body">
                            <strong>This is the first item's accordion body.</strong> It is shown by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button data-mdb-collapse-init
                                class="accordion-button collapsed"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseTwo"
                                aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseTwo">Accordion Item #2</button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingTwo">
                        <div class="accordion-body">
                            <strong>This is the second item's accordion body.</strong> It is hidden by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button data-mdb-collapse-init
                                class="accordion-button collapsed"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseThree"
                                aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseThree">Accordion Item #3</button>
                    </h2>
                    <div id="panelsStayOpen-collapseThree"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingThree">
                        <div class="accordion-body">
                            <strong>This is the third item's accordion body.</strong> It is hidden by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
            </div>
            <hr class="hr">
            <!--REJECTED CLAIMS-->
            <h2 class="mb-3">Rejected Claims</h2>
            <div class="accordion" id="accordionPanelsStayOpenExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button data-mdb-collapse-init
                                class="accordion-button"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseOne"
                                aria-expanded="true"
                                aria-controls="panelsStayOpen-collapseOne">Accordion Item #1</button>
                    </h2>
                    <div id="panelsStayOpen-collapseOne"
                         class="accordion-collapse collapse show"
                         aria-labelledby="headingOne">
                        <div class="accordion-body">
                            <strong>This is the first item's accordion body.</strong> It is shown by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button data-mdb-collapse-init
                                class="accordion-button collapsed"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseTwo"
                                aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseTwo">Accordion Item #2</button>
                    </h2>
                    <div id="panelsStayOpen-collapseTwo"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingTwo">
                        <div class="accordion-body">
                            <strong>This is the second item's accordion body.</strong> It is hidden by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingThree">
                        <button data-mdb-collapse-init
                                class="accordion-button collapsed"
                                type="button"
                                data-mdb-toggle="collapse"
                                data-mdb-target="#panelsStayOpen-collapseThree"
                                aria-expanded="false"
                                aria-controls="panelsStayOpen-collapseThree">Accordion Item #3</button>
                    </h2>
                    <div id="panelsStayOpen-collapseThree"
                         class="accordion-collapse collapse"
                         aria-labelledby="headingThree">
                        <div class="accordion-body">
                            <strong>This is the third item's accordion body.</strong> It is hidden by default,
                            until the collapse plugin adds the appropriate classes that we use to style each
                            element. These classes control the overall appearance, as well as the showing and
                            hiding via CSS transitions. You can modify any of this with custom CSS or overriding
                            our default variables. It's also worth noting that just about any HTML can go within
                            the <code>.accordion-body</code>, though the transition does limit overflow.
                        </div>
                    </div>
                </div>
            </div>
            <hr class="hr">
            <p>{{claims}}</p>
        {% endblock dashboard_content %}
    </div>
{% endblock content %}
